<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin & Municipal Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center">
    <header class="w-full p-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold">Admin & Municipal Dashboard</h1>
        <div class="flex items-center gap-4 text-sm">
            <span id="auth-user-email" class="text-slate-400"></span>
            <button id="logout-btn" class="bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded">Logout</button>
            <a href="index.html" class="text-emerald-400 hover:underline">User App</a>
        </div>
    </header>
    <main class="w-full max-w-4xl p-4 flex flex-col gap-6">
        <section class="bg-slate-800/60 p-4 rounded-lg flex flex-col gap-4">
            <div class="flex flex-wrap gap-4 items-end">
                <div>
                    <label for="municipal-filter" class="block text-sm text-slate-300 mb-1">Filter by Municipal Region</label>
                    <select id="municipal-filter" class="bg-slate-700 text-white px-3 py-2 rounded">
                        <option value="__all__">All Regions</option>
                    </select>
                </div>
                <div>
                    <label for="notify-email" class="block text-sm text-slate-300 mb-1">Notification Email</label>
                    <input id="notify-email" type="email" placeholder="name@example.com" class="bg-slate-700 text-white px-3 py-2 rounded" />
                </div>
                <div>
                    <label for="notify-phone" class="block text-sm text-slate-300 mb-1">SMS Phone (+countrycode)</label>
                    <input id="notify-phone" type="tel" placeholder="+91XXXXXXXXXX" class="bg-slate-700 text-white px-3 py-2 rounded" />
                </div>
                <button id="save-notify-btn" class="bg-emerald-600 hover:bg-emerald-700 font-semibold px-4 py-2 rounded">Save Alerts</button>
            </div>
            <p class="text-xs text-slate-400">Email/SMS here are demo only (no backend). Real delivery requires integrating an email (e.g. Resend, SendGrid) or SMS (e.g. Twilio) provider via a Supabase Edge Function or server. Reports persist in Supabase; they remain visible until explicitly marked cleared.</p>
            <div id="notify-status" class="text-xs text-emerald-400"></div>
        </section>
        <section>
            <h2 class="text-xl font-semibold mb-2">Reported Garbage Locations</h2>
            <div id="admin-map" class="w-full h-96 rounded-lg"></div>
        </section>
        <section class="grid gap-8 md:grid-cols-2">
            <div>
                <h2 class="text-xl font-semibold mb-2 flex items-center gap-2">Active Reports <span id="active-count" class="text-xs bg-slate-700 px-2 py-0.5 rounded"></span></h2>
                <ul id="reports-list" class="space-y-4"></ul>
            </div>
            <div>
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-xl font-semibold flex items-center gap-2">History <span id="history-count" class="text-xs bg-slate-700 px-2 py-0.5 rounded"></span></h2>
                    <button id="toggle-history-visibility" class="text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded">Hide</button>
                </div>
                <ul id="history-list" class="space-y-4 max-h-[32rem] overflow-y-auto"></ul>
            </div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.42.5/dist/umd/supabase.min.js"></script>
    <script src="supabaseClient.js"></script>
    <script>
        // Login/session check removed. Anyone can access this page.
        const supabase = window.supabaseClient;
        // Optionally, you can still show the user email if logged in
        (async function(){
            if (!supabase) return;
            const { data: { session } } = await supabase.auth.getSession();
            const span = document.getElementById('auth-user-email');
            if (span && session && session.user) span.textContent = session.user.email;
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn?.addEventListener('click', async () => {
                await supabase.auth.signOut();
                window.location.href = 'login.html';
            });
        })();
    </script>
    <script src="admin.js"></script>
</body>
</html>
